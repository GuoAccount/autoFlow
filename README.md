# AutoFlow - 安卓自动化工具

## 项目概述
AutoFlow 是一个基于 Android 无障碍服务的自动化工具，支持通过 JSON/YAML 脚本定义自动化任务，实现应用操作的自动执行。

## 核心功能

### 1. 任务管理
- 支持 JSON/YAML 格式的任务脚本
- 任务队列和优先级管理
- 任务执行历史记录

### 2. 自动化操作
- 点击、滑动、输入等基础操作
- 基于无障碍服务的 UI 元素识别与操作
- 支持动态元素处理

### 3. OCR 集成
- 集成 Tesseract OCR 引擎
- 支持多语言文字识别
- 动态元素识别与定位

### 4. 轻量级模型决策
- 基于 TensorFlow Lite 的本地推理
- 支持自定义模型集成
- 模型优化与加速

## 项目结构

```
app/
├── src/
│   ├── main/
│   │   ├── java/com/g2s/autoflow/
│   │   │   ├── core/
│   │   │   │   ├── accessibility/    # 无障碍服务相关
│   │   │   │   ├── ocr/            # OCR 相关功能
│   │   │   │   ├── model/          # 机器学习模型相关
│   │   │   │   └── task/           # 任务管理相关
│   │   │   ├── service/            # 后台服务
│   │   │   ├── ui/                 # 界面相关
│   │   │   └── utils/              # 工具类
│   │   └── res/                    # 资源文件
│   └── test/                       # 单元测试
├── docs/                           # 项目文档
└── scripts/                       # 构建和部署脚本
```

## 技术方案设计

### 一、核心逻辑设计

#### 1. 任务定义与管理

- **任务脚本语言**：采用JSON或YAML格式定义任务脚本，易于编写和解析。脚本包含一系列操作步骤，如点击、滑动、输入文本等。
- **任务队列与调度**：设计一个任务队列，支持任务的添加、删除和优先级调整。使用线程池或协程机制实现任务的高效调度和执行。

#### 2. 无障碍服务实现

- **权限获取与引导**：应用启动时检查无障碍服务权限，若无权限则引导用户至系统设置开启。
- **事件监听与处理**：重写`onAccessibilityEvent`方法，监听屏幕状态变化、窗口更新等事件，触发相应的自动化操作。
- **UI节点解析与操作**：利用`AccessibilityNodeInfo`获取当前界面的UI树，通过ID、文本、坐标等方式定位目标元素，执行点击、输入等操作。

#### 3. OCR集成与应用

- **OCR引擎选择**：集成`Tess-two`或`ML Kit`等本地OCR库，实现图片和屏幕截图的文字识别。
- **动态元素识别**：当遇到无障碍标签缺失或动态变化的元素时，触发屏幕截图，利用OCR识别元素内容，结合UI树定位元素位置。
- **OCR结果处理**：对OCR结果进行后处理，如去除噪声、校正识别错误，提高识别准确率。

#### 4. 轻量级模型决策

- **模型选择与训练**：根据具体需求，选择合适的轻量级模型（如MobileNet、EfficientNet等），在本地或云端进行训练，输出模型文件。
- **模型部署与推理**：使用`TensorFlow Lite`或`PyTorch Mobile`等框架部署模型，实现本地推理。将屏幕截图或UI特征作为输入，输出操作决策。
- **模型优化**：对模型进行量化、剪枝等优化，减小模型体积和推理时间，提升应用性能。

### 二、动态元素处理

#### 1. 元素监控与变化检测

- **元素监听器**：为关键元素设置监听器，监控其属性变化（如文本、位置、可见性等）。
- **哈希值比对**：定期计算UI树的哈希值，与上次计算结果比对，判断界面是否发生变化。

#### 2. 截图与OCR识别

- **屏幕截图**：当检测到界面变化或需要识别动态元素时，触发屏幕截图，保存为图片文件。
- **OCR识别区域定位**：根据UI树中元素的位置信息，确定OCR识别的区域，提高识别效率。
- **多语言支持**：配置OCR引擎支持多种语言，适应不同应用场景。

#### 3. 结果匹配与元素定位

- **文本匹配**：将OCR识别结果与UI树中的文本进行匹配，定位目标元素。
- **图像特征匹配**：对于无法通过文本匹配的元素，提取图像特征（如颜色、形状等），与已知元素特征进行比对，实现定位。

### 三、特殊场景处理

#### 1. 弹窗处理

- **监听弹窗事件**：利用无障碍服务监听弹窗出现事件，及时获取弹窗内容。
- **自动关闭弹窗**：根据弹窗类型和内容，判断是否需要自动关闭或执行相应操作。

#### 2. Toast消息获取

- **监听Toast事件**：通过无障碍服务监听`AccessibilityEvent.TYPE_NOTIFICATION_STATE_CHANGED`事件，获取Toast消息。
- **XPath定位**：使用XPath定位Toast元素，获取其文本内容。

#### 3. 滑动操作

- **滑动检测**：监听滑动事件，判断滑动方向和距离，触发相应的操作。
- **模拟滑动**：使用`Gesture`类或`Swipe`方法模拟用户滑动操作，实现页面滚动或元素选择。

### 四、安全性与稳定性保障

#### 1. 权限管理

- **最小权限原则**：仅申请必要的权限，如无障碍服务、存储访问等，避免过度收集用户信息。
- **权限动态申请**：在需要时动态申请权限，并提供明确的权限使用说明。

#### 2. 异常处理与日志记录

- **异常捕获与处理**：对可能出现的异常进行全面捕获和处理，避免应用崩溃。
- **日志记录与分析**：记录应用运行日志，包括操作步骤、执行结果、异常信息等，便于问题排查和性能优化。

#### 3. 稳定性测试与优化

- **多机型测试**：在不同品牌、型号的安卓设备上进行测试，确保应用兼容性和稳定性。
- **性能优化**：优化代码逻辑，减少资源消耗，提高应用运行效率。

## 快速开始
1. 克隆项目
2. 使用 Android Studio 打开项目
3. 同步 Gradle 依赖
4. 运行应用

## 依赖项
- Kotlin 协程
- TensorFlow Lite
- Tesseract OCR
- Gson/YAML 解析库

## 许可证
MIT License
